<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Conference</title>
<<<<<<< HEAD
    <link rel="stylesheet" href="./../Css/ProductStylee.css">
=======
    <link rel="stylesheet" href="../Css/ProductStylee.css">
>>>>>>> b2219171d777dfb611a57fb0396d4e84e254b4d7
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>

</head>

<body>
    <!--header-->
    <header>
        <!--nav-->
        <div class="nav container">
            <a href="#" class="logo">SMART</a>
            <span id="user-name" style="margin: auto;"></span><!--icon-cart-->
            <i class='bx bx-shopping-bag' id="cart-icon"></i>
            <!-- cart -->
            <div class="cart">
                <h2 class="cart-title">Resumen</h2>
                <!-- content -->
                <div class="cart-content">

                </div>
                <!-- total -->
                <div class="total">
                    <div class="total-title">Total</div>
                    <div class="total-price">Q0</div>
                </div>
                <!-- Método de pago -->
                <div class="payment-method">
                    <label>
                        <input type="radio" name="payment" value="efectivo" checked> Efectivo
                    </label>
                    <label>
                        <input type="radio" name="payment" value="tarjeta"> Tarjeta
                    </label>
                </div>
                <!-- Pay button -->
                <button type="button" class="btn-buy">Pagar</button>
                <!-- cart close -->
                <i class='bx bx-x' id="close-cart"></i>
            </div>
        </div>
        </div>
    </header>
    <!--shop-->
    <section class="shop container">
        <h2 class="section-title">Productos</h2>
        <!--Content-->
        <div class="shop-content">
            <!--box 1-->
            <div class="product-box">
<<<<<<< HEAD
                <img src="./../Img/tortilla de harina.jpg" alt="" class="product-img">
                <h2 class="product-title">tortillas de harina</h2>
                <span class="price">Q30.00</span>
=======
                <img src="../Img/Tostadas.jpg" alt="" class="product-img">
                <h2 class="product-title">chuchitos</h2>
                <span class="price">Q10.00</span>
>>>>>>> b2219171d777dfb611a57fb0396d4e84e254b4d7

                <i class='bx bx-shopping-bag add-cart'></i>
            </div>
            <!--box 2-->
            <div class="product-box">
<<<<<<< HEAD
                <img src="./../Img/churrasquitos.jpg" alt="" class="product-img">
                <h2 class="product-title">churrasquitos</h2>
                <span class="price">Q30.00</span>
=======
                <img src="../Public/Img/Tostadas.jpg" alt="" class="product-img">
                <h2 class="product-title">tortillas de harina</h2>
                <span class="price">Q20.00</span>
>>>>>>> b2219171d777dfb611a57fb0396d4e84e254b4d7

                <i class='bx bx-shopping-bag add-cart'></i>

            </div>
            <!--box 3-->
            <div class="product-box">
                <img src="./../Img/tacos.jpg" alt="" class="product-img">
                <h2 class="product-title">tacos</h2>
                <span class="price">Q30.00</span>

                <i class='bx bx-shopping-bag add-cart'></i>
            </div>
            <!--box 4-->
            <div class="product-box">
                <img src="./../Img/panConPierna.jpg" alt="" class="product-img">
                <h2 class="product-title">pan con pierna</h2>
                <span class="price">Q25.00</span>

                <i class='bx bx-shopping-bag add-cart'></i>
            </div>
            <div class="product-box">
                <img src="./../Img/panConPollo.jpg" alt="" class="product-img">
                <h2 class="product-title">pan con pollo</h2>
                <span class="price">Q20.00</span>

                <i class='bx bx-shopping-bag add-cart'></i>
            </div>
            <!--box 5-->
            <div class="product-box">
                <img src="./../Img/dobladas.jpg" alt="" class="product-img">
                <h2 class="product-title">dobladas</h2>
                <span class="price">Q20.00</span>

                <i class='bx bx-shopping-bag add-cart'></i>
            </div>
            <!--box 6-->
            <div class="product-box">
                <img src="./../Img/fresas con crema.jpg" alt="" class="product-img">
                <h2 class="product-title">fresas con crema</h2>
                <span class="price">Q20.00</span>

                <i class='bx bx-shopping-bag add-cart'></i>
            </div> <!--box 7-->
            <div class="product-box">
                <img src="./../Img/chuchitos.jpg" alt="" class="product-img">
                <h2 class="product-title">chuchitos</h2>
                <span class="price">Q15.00</span>

                <i class='bx bx-shopping-bag add-cart'></i>
            </div> <!--box 8-->
            <div class="product-box">
                <img src="./../Img/tostadas.jpgf" alt="" class="product-img">
                <h2 class="product-title">tostadas</h2>
                <span class="price">Q15.00</span>

                <i class='bx bx-shopping-bag add-cart'></i>
            </div>
            <div class="product-box">
                <img src="./../Img/enchiladas.jpg" alt="" class="product-img">
                <h2 class="product-title">enchiladas</h2>
                <span class="price">Q10.00</span>

                <i class='bx bx-shopping-bag add-cart'></i>
            </div>
            <div class="product-box">
                <img src="./../Img/atol.jpg" alt="" class="product-img">
                <h2 class="product-title">arroz con leche</h2>
                <span class="price">Q10.00</span>

                <i class='bx bx-shopping-bag add-cart'></i>
            </div>
            <div class="product-box">
                <img src="./../Img/chocolate.jpg" alt="" class="product-img">
                <h2 class="product-title">arroz con chocolate</h2>
                <span class="price">Q10.00</span>

                <i class='bx bx-shopping-bag add-cart'></i>
            </div>
            <div class="product-box">
                <img src="./../Img/ponche.jpg" alt="" class="product-img">
                <h2 class="product-title">ponche</h2>
                <span class="price">Q10.00</span>

                <i class='bx bx-shopping-bag add-cart'></i>
            </div>

        </div>
    </section>
<<<<<<< HEAD
    <script src="./../src/ScriptProducts.js"></script>
=======
    <script src="../src/ScriptProducts.js"></script>
>>>>>>> b2219171d777dfb611a57fb0396d4e84e254b4d7
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.2/jspdf.umd.min.js"></script>
    <sc type="module">
        <script type="module">
            // Importar las funciones necesarias de Firebase
            import { initializeApp } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js";
            import { getDatabase, set, ref } from "https://www.gstatic.com/firebasejs/9.0.0/firebase-database.js";

            // Configuración de Firebase
            const firebaseConfig = {
                apiKey: "AIzaSyAfCUIkzmvFID38aezo72XIRB3fVzodC2Q",
                authDomain: "smartconference-2024.firebaseapp.com",
                databaseURL: "https://smartconference-2024-default-rtdb.firebaseio.com",
                projectId: "smartconference-2024",
                storageBucket: "smartconference-2024.firebasestorage.app",
                messagingSenderId: "495251658201",
                appId: "1:495251658201:web:d0a66836866535d773b5c8"
            };

            // Inicializar Firebase
            const app = initializeApp(firebaseConfig);
            const db = getDatabase(app);

            // Obtener el botón de compra
            const buyButtons = document.getElementsByClassName("btn-buy");
            // Inicializa un array para almacenar los productos seleccionados
            let selectedProducts = [];

            // Función para agregar un producto a la lista
            function addProductToList(productTitle, productPrice) {
                const product = {
                    title: productTitle,
                    price: parseFloat(productPrice.replace("Q", "")), // Convertir el precio a número
                    quantity: 1 // Cantidad por defecto
                };
                selectedProducts.push(product);
                console.log('Producto agregado a la lista:', product);
            }

            // Función para actualizar el total dinámicamente
            function updateTotal() {
                const quantities = document.querySelectorAll('.cart-quantity');
                let total = 0;

                quantities.forEach((quantity, index) => {
                    const quantityValue = parseInt(quantity.value) || 1; // Valor por defecto 1 si el campo está vacío
                    selectedProducts[index].quantity = quantityValue; // Actualiza la cantidad en el array
                    total += selectedProducts[index].price * quantityValue; // Calcula el total
                });

                // Actualizar el total en la interfaz
                document.getElementsByClassName('total-price')[0].innerText = 'Q' + total.toFixed(2);
            }

            // Función para enviar la lista de productos y el total a Firebase
            function sendPaymentToFirebase(paymentMethod, total) {
                const paymentsRef = ref(db, 'Pagos/' + Date.now()); // Usar timestamp como ID único

                // Crear un objeto de pago
                const paymentData = {
                    products: selectedProducts,
                    total: total,
                    paymentMethod: paymentMethod,
                };

                // Almacenar el pago en Firebase
                set(paymentsRef, paymentData)
                    .then(() => {
                        console.log('Pago enviado correctamente:', paymentData);
                    })
                    .catch((error) => {
                        console.error('Error al enviar el pago:', error);
                    });

                // Limpiar la lista de productos después de enviar
                selectedProducts = [];
            }

            // Función que se ejecuta al hacer clic en el botón de compra
            function buyButtonClicked() {
                const paymentMethod = document.querySelector('input[name="payment"]:checked')?.value;

                if (!paymentMethod) {
                    alert('Por favor, selecciona un método de pago.');
                    return;
                }

                // Actualizar el total antes de calcularlo
                updateTotal();

                // Calcular el total a partir de selectedProducts
                let total = selectedProducts.reduce((acc, product) => acc + (product.price * product.quantity), 0);

                // Añadir el cargo extra si se paga con tarjeta
                if (paymentMethod === 'tarjeta') {
                    total += total * 0.05; // Agregar 5% al total
                }

                alert(`Tu orden ha sido procesada. Total a pagar: Q${total.toFixed(2)}`);
                sendPaymentToFirebase(paymentMethod, total);

                const cartContent = document.getElementsByClassName('cart-content')[0];
                while (cartContent.hasChildNodes()) {
                    cartContent.removeChild(cartContent.firstChild);
                }

                // Limpiar el array de productos seleccionados
                selectedProducts = [];
            }

            // Agregar evento a los inputs de cantidad
            document.addEventListener('input', (event) => {
                if (event.target.classList.contains('cart-quantity')) {
                    updateTotal();
                }
            });

            // Config ```javascript
            // Configurar los botones de agregar al carrito
            const addCartButtons = document.querySelectorAll('.add-cart');
            addCartButtons.forEach(button => {
                button.addEventListener('click', function () {
                    const productBox = button.closest('.product-box');
                    const productTitle = productBox.querySelector('.product-title').innerText;
                    const productPrice = productBox.querySelector('.price').innerText;

                    addProductToList(productTitle, productPrice);
                });
            });

            // Agregar evento al botón de compra
            const payButton = document.querySelector('.btn-buy');
            payButton.addEventListener('click', buyButtonClicked);
        </script>



</body>

</html>